#! /usr/local/bin/bzt
---
modules:
  jmeter:
    properties:
      base_url: http://aws-uut:8000

execution:
  concurrency: 2  # number of threads
  throughput: 1   # limit hits/s
  hold-for: 1m
  ramp-up: 30s
  scenario:
    requests:
    - label: Home
      url: ${__P(base_url)}
      method: GET
      think-time: 500ms
      assert: 
      - contains:
        - Welcome
        subject: body
        regexp: false
    - transaction: Reserve a flight
      do:
      - label: Home
        url: ${__P(base_url)}
        method: GET
        think-time: 500ms
        assert: 
        - contains:
          - Welcome
        extract-regexp:
          token: "<input type='hidden' name='csrfmiddlewaretoken' value='(.+)' />"
        subject: body
        regexp: false
      - label: Select from and to cities
        url: ${__P(base_url)}/reserve/
        method: POST
        body:
          fromPort: New York
          toPort: Boston
          csrfmiddlewaretoken: ${token}
        think-time: 1s
        assert:
        - from New York
        - to Philadelphia
